# Отчет по ДЗ 1: Введение в ETL и основы работы с данными

## Выбранный кейс

**BankShield** - система анализа банковских транзакций для выявления аномалий и мошенничества. Проект включает сбор транзакций, их хранение в MongoDB (операционная БД) и перенос в PostgreSQL (аналитическая БД) через EL-процесс.

## Инфраструктура

Локальная среда развернута с помощью `docker-compose` и включает:

- **PostgreSQL 15** - целевая база для аналитических данных (порт 5433)
- **MongoDB 7** - источник данных для "продового приложения" (порт 27017)
- **Apache Airflow 2.8.0** - оркестрация EL-процессов (порт 8080)
- **Grafana** - визуализация данных (порт 3001)
- **bankshield-collector** - Python-приложение для генерации транзакций

Все сервисы настроены с health checks и автоматическим перезапуском.

## Python-приложение (bankshield-collector)

Приложение реализовано в модуле `bankshield.collector` и выполняет следующие функции:

- Генерация синтетических транзакций с различными характеристиками (сумма, валюта, тип, категория мерчанта)
- Запись транзакций в MongoDB (база `banking_data`, коллекция `transactions`)
- Поддержка загрузки данных с Kaggle (опционально)
- Настраиваемый интервал сбора данных

Приложение запускается как Docker-контейнер и работает непрерывно, генерируя транзакции каждые 60 секунд.

## EL-процесс в Airflow

### Настройка переменных

В Airflow настроены переменные для подключения к MongoDB и PostgreSQL:

![Airflow Variables](figures/airflow_variables.png)

### DAG: transactions_etl

Создан DAG `transactions_etl`, который выполняет EL-процесс:

1. **Extract** - извлечение транзакций из MongoDB
2. **Load** - загрузка транзакций в PostgreSQL

DAG запускается каждые 30 минут и обрабатывает только новые транзакции (на основе timestamp).

![Airflow DAG List](figures/airflow-dag-list.png)

![Airflow DAG Graph](figures/airflow_dag_graph.png)

### Схема данных в PostgreSQL

Таблица `transactions` включает:
- Основные поля транзакции (ID, сумма, валюта, тип)
- Информацию о пользователе и мерчанте
- Геолокацию (страна, город, координаты)
- Информацию об устройстве
- Флаг мошенничества (`is_fraud`) и риск-скор
- Индексы для быстрого поиска

## Визуализация в Grafana

Создан дашборд для визуализации транзакций и статистики по мошенничеству:

![Grafana Dashboard](figures/graphana-transactions-dashboard.png)

Дашборд включает:
- Общее количество транзакций
- Количество мошеннических транзакций
- Процент мошенничества
- Временные графики транзакций
- Распределение по типам транзакций и категориям мерчантов

## Результаты

✅ Все компоненты успешно развернуты и работают
✅ Python-приложение генерирует транзакции в MongoDB
✅ EL-процесс переносит данные из MongoDB в PostgreSQL
✅ Данные визуализируются в Grafana
✅ Процесс автоматизирован через Airflow

## Ссылки

- **Airflow UI**: http://localhost:8080 (airflow/airflow)
- **Grafana**: http://localhost:3001 (admin/admin)
- **Репозиторий**: [GitHub репозиторий проекта]

## Артефакты

- ✅ Git-репозиторий с кодом проекта
- ✅ Python-приложение для записи в MongoDB
- ✅ EL-процесс в Airflow для переноса данных
- ✅ Рабочая инфраструктура на Docker Compose
- ✅ Дашборд в Grafana для визуализации
